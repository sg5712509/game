<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ëª¨ë¦¬ ì¹´ë“œ ê²Œì„ ğŸ®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        h1 { margin-top: 10px; }

        .stats {
            margin: 10px;
            font-size: 18px;
        }
        #restartBtn {
            padding: 7px 14px;
            font-size: 15px;
            cursor: pointer;
        }

        #difficultySelect {
            padding: 5px;
            margin-left: 10px;
        }

        .game-container {
            display: grid;
            gap: 10px;
            justify-content: center;
            padding: 10px;
        }

        .card {
            width: 90px;
            height: 90px;
            perspective: 600px;
            cursor: pointer;
        }
        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s;
        }
        .card.flip .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
        }
        .card-front {
            background: #fff;
            border: 2px solid #222;
        }
        .card-back {
            background: #4CAF50;
            color: white;
            font-size: 35px;
            display: flex;
            justify-content: center;
            align-items: center;
            transform: rotateY(180deg);
        }

        /* ìŠ¹ë¦¬ ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

<h1>ë©”ëª¨ë¦¬ ì¹´ë“œ ê²Œì„</h1>

<div class="stats">
    Moves: <span id="movesDisplay">0</span> |
    Time: <span id="timerDisplay">0</span> sec |
    Best Score: <span id="bestScore">-</span>
</div>

<button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>

<select id="difficultySelect">
    <option value="4">ì‰¬ì›€ (4ìŒ)</option>
    <option value="6" selected>ë³´í†µ (6ìŒ)</option>
    <option value="8">ì–´ë ¤ì›€ (8ìŒ)</option>
</select>

<div class="game-container" id="gameBoard"></div>

<!-- ìŠ¹ë¦¬ ëª¨ë‹¬ -->
<div id="winModal" class="modal">
    <div class="modal-content">
        <h2>ğŸ‰ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!</h2>
        <p id="finalStats"></p>
        <button id="closeModalBtn">ë‹«ê¸°</button>
    </div>
</div>

<script>
    const allIcons = ["ğŸ","ğŸŒ","ğŸ’","ğŸ‡","ğŸ¥","ğŸ","ğŸ‰","ğŸ“","ğŸ‘","ğŸ‹","ğŸ","ğŸ"];
    let currentDifficulty = 6;
    let deck = [];
    let moves = 0;
    let timer = 0, timerInterval;
    let firstCard = null, secondCard = null;
    let lockBoard = false, matchedCount = 0;

    const gameBoard = document.getElementById("gameBoard");
    const movesDisplay = document.getElementById("movesDisplay");
    const timerDisplay = document.getElementById("timerDisplay");
    const restartBtn = document.getElementById("restartBtn");
    const difficultySelect = document.getElementById("difficultySelect");
    const bestScoreSpan = document.getElementById("bestScore");

    const winModal = document.getElementById("winModal");
    const finalStats = document.getElementById("finalStats");
    const closeModalBtn = document.getElementById("closeModalBtn");

    // ì ìˆ˜ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    function getBestScore(level) {
        const scores = JSON.parse(localStorage.getItem("memoryBest")) || {};
        return scores[level] || null;
    }
    function saveBestScore(level, moves, time) {
        const scores = JSON.parse(localStorage.getItem("memoryBest")) || {};
        const prev = scores[level];
        if (!prev || (moves < prev.moves) || (moves === prev.moves && time < prev.time)) {
            scores[level] = {moves, time};
            localStorage.setItem("memoryBest", JSON.stringify(scores));
        }
    }

    function showBestScore() {
        const b = getBestScore(currentDifficulty);
        bestScoreSpan.textContent = b ? `${b.moves} moves, ${b.time} sec` : "-";
    }

    function startTimer() {
        clearInterval(timerInterval);
        timer = 0;
        timerDisplay.textContent = timer;
        timerInterval = setInterval(() => {
            timer++;
            timerDisplay.textContent = timer;
        }, 1000);
    }

/*    function initGame() {
        clearInterval(timerInterval);
        moves = 0; matchedCount = 0;
        movesDisplay.textContent = moves;
        gameBoard.innerHTML = "";

        // ì¹´ë“œë°í¬ ìƒì„± í›„ ì…”í”Œ
        const icons = allIcons.slice(0, currentDifficulty);
        deck = [...icons, ...icons];
        deck.sort(() => Math.random() - 0.5);

        // ê·¸ë¦¬ë“œ ì‚¬ì´ì¦ˆ
        gameBoard.style.gridTemplateColumns = `repeat(${Math.min(currentDifficulty, 6)}, 90px)`;

        deck.forEach(icon => {
            const card = document.createElement("div");
            card.classList.add("card");
            card.dataset.icon = icon;
            card.innerHTML = `
                <div class="card-inner">
                    <div class="card-face card-front"></div>
                    <div class="card-face card-back">${icon}</div>
                </div>
            `;
            gameBoard.appendChild(card);
            card.addEventListener("click", flipCard);
        });

        showBestScore();
        firstCard = secondCard = null;
        lockBoard = false;
        startTimer();
    }*/

    function initGame() {
        clearInterval(timerInterval);
        moves = 0; matchedCount = 0;
        movesDisplay.textContent = moves;
        gameBoard.innerHTML = "";

        const icons = allIcons.slice(0, currentDifficulty);
        deck = [...icons, ...icons];
        deck.sort(() => Math.random() - 0.5);

        gameBoard.style.gridTemplateColumns = `repeat(${Math.min(currentDifficulty, 6)}, 90px)`;

        deck.forEach(icon => {
            const card = document.createElement("div");
            card.classList.add("card");
            card.dataset.icon = icon;
            card.innerHTML = `
            <div class="card-inner">
                <div class="card-face card-front"></div>
                <div class="card-face card-back">${icon}</div>
            </div>
        `;
            gameBoard.appendChild(card);
            card.addEventListener("click", flipCard);
        });

        showBestScore();
        firstCard = secondCard = null;
        lockBoard = true;  // ì´ ì‹œì ì—” í´ë¦­ ë§‰ê¸°

        // **ë¯¸ë¦¬ë³´ê¸°: ëª¨ë“  ì¹´ë“œ ë’¤ì§‘ê¸°**
        document.querySelectorAll(".card").forEach(c => c.classList.add("flip"));

        // **ì¼ì • ì‹œê°„(ì˜ˆ: 2ì´ˆ) í›„ ì¹´ë“œ ìˆ¨ê¸°ê¸°**
        setTimeout(() => {
            document.querySelectorAll(".card").forEach(c => c.classList.remove("flip"));
            lockBoard = false;  // ì´ì œ í´ë¦­ í—ˆìš©
            startTimer();
        }, 2000); // 2000 = 2ì´ˆ

        timerDisplay.textContent = "0";
    }


    function flipCard() {
        if(lockBoard || this === firstCard) return;

        this.classList.add("flip");

        if (!firstCard) {
            firstCard = this;
            return;
        }

        secondCard = this;
        lockBoard = true;

        moves++;
        movesDisplay.textContent = moves;

        checkMatch();
    }

    function checkMatch() {
        let match = firstCard.dataset.icon === secondCard.dataset.icon;
        setTimeout(() => {
            if (!match) {
                firstCard.classList.remove("flip");
                secondCard.classList.remove("flip");
            } else {
                matchedCount += 2;
            }
            resetBoard();

            if (matchedCount === deck.length) {
                clearInterval(timerInterval);
                saveBestScore(currentDifficulty, moves, timer);
                showBestScore();
                finalStats.textContent = `Moves: ${moves}, Time: ${timer}sec`;
                winModal.style.display = "flex";
            }
        }, 800);
    }

    function resetBoard() {
        [firstCard, secondCard, lockBoard] = [null, null, false];
    }

    closeModalBtn.addEventListener("click", () => {
        winModal.style.display = "none";
    });




    restartBtn.addEventListener("click", initGame);

    difficultySelect.addEventListener("change", (e) => {
        currentDifficulty = parseInt(e.target.value);
        initGame();
    });

    initGame();
</script>

</body>
</html>
